name: 자동 포스팅 (Auto Publish to Discussions)

# 언제 실행할까요?
# main 브랜치에 '마크다운(.md)' 파일이 push 되었을 때만!
on:
  push:
    branches:
      - main
    paths:
      - '**.md'

# 권한 설정 (게시판에 글을 써야 하니까 write 권한 필요)
permissions:
  contents: write
  discussions: write

jobs:
  publish-discussion:
    runs-on: ubuntu-latest
    steps:
      - name: 코드 가져오기 (Checkout Code)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 

      - name: 새로 추가된 파일 찾기 (Find Added Files)
        id: changed-files
        uses: tj-actions/changed-files@v45
        with:
          files: '**.md'  # 마크다운 파일만 감시
          status_filter: 'added' # 최종 수정: 'status' -> 'status_filter'

      - name: Discussions에 글 발행하기 (Publish Discussion Post)
        # GitHub CLI 대신 안정적인 전용 Action 사용
        uses: sergey-pr/gh-action-discussion@v1 
        with:
          files: ${{ steps.changed-files.outputs.added_files }}
          category: General
          title-from-path: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
