name: 자동 포스팅 (Auto Publish to Discussions)

# 언제 실행할까요?
# main 브랜치에 '마크다운(.md)' 파일이 push 되었을 때만!
on:
  push:
    branches:
      - main
    paths:
      - '**.md'

# 권한 설정 (게시판에 글을 써야 하니까 write 권한 필요)
permissions:
  contents: write
  discussions: write

jobs:
  publish-discussion:
    runs-on: ubuntu-latest
    steps:
      - name: 코드 가져오기 (Checkout Code)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # 변경 사항을 감지하기 위해 히스토리 가져오기

      - name: 새로 추가된 파일 찾기 (Find Added Files)
        id: changed-files
        uses: tj-actions/changed-files@v45
        with:
          files: '**.md'  # 마크다운 파일만 감시
          status: 'added' # '수정'된 건 무시하고 '새로 추가'된 것만 찾음

      - name: Discussions에 글 발행하기 (Publish Discussion Post)
        # GitHub CLI 대신 안정적인 전용 Action 사용
        uses: sergey-pr/gh-action-discussion@v1
        with:
          # Find Newly Added Files 스텝에서 찾은 파일 목록을 전달
          files: ${{ steps.changed-files.outputs.added_files }}
          # Discussions 카테고리 지정
          category: General
          # 파일 이름에서 .md 확장자를 제거한 것을 제목으로 사용
          title-from-path: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # 깃허브가 주는 기본 열쇠 (Secret)